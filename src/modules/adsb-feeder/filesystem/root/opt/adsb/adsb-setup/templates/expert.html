{% extends 'base.html' %}
{% set active_page = "expert" %}

{% block content %}
<h1 class="mt-3 text-center text-danger">{% block title %} Expert setup {% endblock %}</h1>
<div>
  {% with messages = get_flashed_messages() %}
  {% if messages %}
  {% for message in messages %}
  <div class="alert alert-warning">
    {{ message }}
  </div>
  {% endfor %}
  {% endif %}
  {% endwith %}
</div>
<div class="row small">
  <div class="col-12 col-lg-6">
    <h5 class="mt-3">Add additional Ultrafeeder arguments</h5>
    <form method="POST">
      <div class="row align-items-center">
        <div class="col-12 mb-2">
          <label for="ultrafeeder_extra_args">
            There are very few circumstances where this is something you want to manually add. One might be a
            situation where you want to feed an aggregator that uses the 'standard' format of all the account-less
            aggregators, but that isn't supported out of the box.
            Add the configuration that you need here - it will be appended to the Ultrafeeder config.
          </label>
        </div>
        {% if is_enabled('stage2') %}
        <div class="col-12 mb-2">Stage2: applied to all microsite ultrafeeder instances (SITENUM is replaced with 00, 01, 02 and so forth):</div>
        <div class="col-8">
          <input class="mx-auto w-100" id="ultrafeeder_extra_args_microsites" name="ultrafeeder_extra_args_microsites"
                 type="text" value="{{ env_value_by_tag('ultrafeeder_extra_args_microsites') }}">
        </div>
        <div class="col-4">
          <button type="submit" class="btn btn-primary mx-auto w-100" name="ultrafeeder_extra_args_microsites--submit"
                  value="go">Submit</button>
        </div>
        <div class="col-12 mb-2">Stage2: applied to the ultrafeeder instance with combined data:</div>
        <div class="col-8">
          <input class="mx-auto w-100" id="ultrafeeder_extra_args" name="ultrafeeder_extra_args" type="text"
                 value="{{ env_value_by_tag('ultrafeeder_extra_args') }}">
        </div>
        <div class="col-4">
          <button type="submit" class="btn btn-primary mx-auto w-100" name="ultrafeeder_extra_args--submit"
                  value="go">Submit</button>
        </div>
        {% else %}
        <div class="col-8">
          <input class="mx-auto w-100" id="ultrafeeder_extra_args" name="ultrafeeder_extra_args" type="text"
                 value="{{ env_value_by_tag('ultrafeeder_extra_args') }}">
        </div>
        <div class="col-4">
          <button type="submit" class="btn btn-primary mx-auto w-100" name="ultrafeeder_extra_args--submit"
                  value="go">Submit</button>
        </div>
        {% endif %}
      </div>
    </form>
  </div>
  <div class="col-12 col-lg-6">
    <h5 class="mt-3">Add environment variables to containers</h5>
    <form method="POST">
      <div class="row align-items-center">
        <div class="col-12 mb-2">
          <label for="ultrafeeder_extra_env">
            The various Docker containers support a lot more environment variables than are exposed here in
            the UI. If there are settings that you need to add, this is the best place to do it. Please only use this if
            you understand what you are doing. It's reasonably simple to break your setup by inserting things here that
            cause the container not to start.<br />
            Please enter them one per line, with an equals sign separating the variable name from its value. The name
            spaces for the different containers are distinct, so for simplicity they are all just added here together.
          </label>
        </div>
        <div class="col-8">
          <textarea class="mx-auto w-100" id="ultrafeeder_extra_env" name="ultrafeeder_extra_env"
                    placeholder="READSB_RTLSDR_PPM=22&#13;&#10;READSB_RANGE_OUTLINE_HOURS=72">{{ env_value_by_tag('ultrafeeder_extra_env') }}</textarea>
        </div>
        <div class="col-4">
          <button type="submit" class="btn btn-primary mx-auto w-100" name="ultrafeeder_extra_env--submit"
                  value="go">Submit</button>
        </div>
      </div>
    </form>
  </div>
  <div class="col-12 col-lg-6">
    <h5 class="mt-3">Add arguments to map URLs</h5>
    <form method="POST">
      <div class="row align-items-center">
        <div class="col-12 mb-2">
          <label for="tar1090_query_params">
            tar1090, the software used to create the map display used here, contains a plethora of URL <a
               href="https://github.com/wiedehopf/tar1090/blob/master/README-query.md">query parameters</a>. If you have
            preferred query parameters that you always want to use, you can add them here.
          </label>
        </div>
        <div class="col-8">
          <input class="mx-auto w-100" id="tar1090_query_params" name="tar1090_query_params" type="text"
                 placeholder="?autoselect&centerReceiver" value="{{ env_value_by_tag('tar1090_query_params') }}">
        </div>
        <div class="col-4">
          <button type="submit" class="btn btn-primary mx-auto w-100" name="tar1090_query_params--submit"
                  value="go">Submit</button>
        </div>
      </div>
    </form>
  </div>
  {% if is_enabled('has_gpsd') %}
  {% if is_enabled('use_gpsd') %}
  <div class="col-12 col-lg-6">
    <h5 class="mt-3">GPS based location</h5>
    <form method="POST">
      <div class="row align-items-center">
        <div class="col-8">
          <label for="turn_off_gpsd">
            Select this to stop using GPS derived location data.
          </label>
        </div>
        <div class="col-4">
          <button type="submit" class="btn btn-primary mx-auto w-100" name="turn_off_gpsd" value="go">Update
            Settings</button>
        </div>
      </div>
    </form>
  </div>
  {% else %}
  <div class="col-12 col-lg-6">
    <h5 class="mt-3">GPS based location</h5>
    <form method="POST">
      <div class="row align-items-center">
        <div class="col-8">
          <label for="turn_on_gpsd">
            You appear to have gpsd installed and configured. Select this to use GPS derived location data.
          </label>
        </div>
        <div class="col-4">
          <button type="submit" class="btn btn-primary mx-auto w-100" name="turn_on_gpsd" value="go">Update
            Settings</button>
        </div>
      </div>
    </form>
  </div>
  {% endif %}
  {% endif %}
  {% if env_value_by_tag('tar1090_image_config_link') != '' %}
  <div class="col-12 col-lg-6">
    <h5 class="mt-3">Don't show config link on map page</h5>
    <form method="POST" onsubmit="show_spinner(); return true;">
      <div class="row align-items-center">
        <div class="col-8">
          <label for="no_config_link">If you want to share ONLY the map / statistics with others, but don't want to show
            them the link to the adsb.im feeder image home page (which allows them to change the configuration), you can
            disable it here. Please note that the user still can simply access that page by changing the port that they
            access your feeder on from {{ env_value_by_tag('tar1090port') }} to {{ env_value_by_tag('webport') }},
            unless you filter this out through some firewall settings (which isn't something this image supports).
          </label>
        </div>
        <div class="col-4">
          <button type="submit" class="btn btn-primary mx-auto w-100" name="no_config_link" value="go">Update
            Settings</button>
        </div>
      </div>
    </form>
  </div>
  {% else %}
  <div class="col-12 col-lg-6">
    <h5 class="mt-3">Show config link on map page</h5>
    <form method="POST" onsubmit="show_spinner(); return true;">
      <div class="row align-items-center">
        <div class="col-8">
          <label for="allow_config_link">Reenable the link to the adsb.im feeder image home page on the map page.
            Please make sure that both the map port {{ env_value_by_tag('tar1090port') }} and the feeder UI port
            {{ env_value_by_tag('webport') }} are accessible to users.
          </label>
        </div>
        <div class="col-4">
          <button type="submit" class="btn btn-primary mx-auto w-100" name="allow_config_link" value="go">Update
            Settings</button>
        </div>
      </div>
    </form>
  </div>
  {% endif %}
  <div class="col-12 col-lg-6">
    <h5 class="mt-3">CSS Theme</h5>
    <form method="POST" onsubmit="show_spinner(); return true;">
      <div class="row align-items-center">
        <div class="col-8">
          <input type="radio" name="css_theme" id="css_light" value="light" {% if
          env_value_by_tag("css_theme")=="light" %} checked {% endif %}>
          <label class="form-check-label mr-3" for="css_light">Light Theme</label>
          <input type="radio" name="css_theme" id="css_dark" value="dark" {% if
          env_value_by_tag("css_theme")=="dark" %} checked {% endif %}>
          <label class="form-check-label mr-3" for="css_dark">Dark Theme</label>
          <input type="radio" name="css_theme" id="css_auto" value="auto" {% if
          env_value_by_tag("css_theme")=="auto" %} checked {% endif %}>
          <label class="form-check-label mr-3" for="css_auto">Auto</label>
        </div>
        <div class="col-4">
          <button type="submit" class="btn btn-primary mx-auto w-100" name="css_theme--submit"
                  value="go">Submit</button>
        </div>
      </div>
    </form>
  </div>
  {% if is_enabled('docker_concurrent') %}
  <div class="col-12 col-lg-6">
    <h5 class="mt-3">Docker pull: Disable concurrent downloads</h5>
    <form method="POST" onsubmit="show_spinner(); return true;">
      <div class="row align-items-center">
        <div class="col-8">
          <label for="disable_parallel_docker">
            Disabling concurrent downloads can be helpful on slow connections to avoid update
            failures or improve update speed slightly.
          </label>
        </div>
        <div class="col-4">
          <button type="submit" class="btn btn-primary mx-auto w-100" name="disable_parallel_docker" value="go">
            Disable concurrency</button>
        </div>
      </div>
    </form>
  </div>
  {% else %}
  <div class="col-12 col-lg-6">
    <h5 class="mt-3">Docker pull: Enable concurrent downloads</h5>
    <form method="POST" onsubmit="show_spinner(); return true;">
      <div class="row align-items-center">
        <div class="col-8">
          <label for="enable_parallel_docker">
            Concurrent downloads are the default behavior and work well on most connections.
            However, not using concurrent downloads can be helpful on slow connections to avoid
            update failures or improve update speed slightly.
          </label>
        </div>
        <div class="col-4">
          <button type="submit" class="btn btn-primary mx-auto w-100" name="enable_parallel_docker" value="go">
            Enable concurrency</button>
        </div>
      </div>
    </form>
  </div>
  {% endif %}
  <div class="col-12"><!-- ensure that the next row is on a new line --> </div>
  <div class="col-12 col-lg-6">
    <h5 class="mt-3">Enable non-ADS-B containers</h5>
    <form method="POST" onsubmit="show_spinner(); return true;">
      <div class="row align-items-center">
        <div class="col-12 mb-2">
          While this may not be interesting to most users, it is possible to enable a number of others
          SDR-based tracking containers in this image. Contrary to the ADS-B experience, those (so far)
          do not have a configuration UI, so this is a lot more manual work to get working, and several
          actually need you to log into the image and manually edit config files. However, having a way
          to at least enable these containers and continue to have a single Docker network for all of
          them to coexist in is quite useful for those who want to explore more than just ADS-B (and UAT)
          tracking.
        </div>
        <div class="col-12 mt-2">
          <div class="row border">
            <!-- first ACARS -->
            {% if not is_enabled('acarsdec') %}
            <div class="col-8 my-1">
              <label for="acarsdec--enable">
                Enable first analog ACARS decoder
              </label>
            </div>
            <div class="col-4 my-1">
              <button type="submit" class="btn btn-primary mx-auto w-100" name="acarsdec--enable"
                      value="go">Enable</button>
            </div>
            {% else %}
            <div class="col-6 my-1">
              <label for="acarsdec--disable">
                First analog ACARS decoder
              </label>
            </div>
            <div class="col-3 my-1">
              <button type="submit" class="btn btn-secondary mx-auto w-100" name="acarsdec--disable"
                      value="go">Disable</button>
            </div>
            <div class="col-3 my-1">
              <button type="submit" class="btn btn-primary mx-auto w-100" name="acarsdec--update"
                      value="go">Update</button>
            </div>
            <div class="col-4 mb-1">
              <label for="acars_feed_id">
                ACARS feed ID
              </label>
            </div>
            <div class="col-8 mb-1">
              <input type="text" class="mx-auto w-100" name="acars_feed_id" id="acars_feed_id"
                     value="{{ env_value_by_tag('acars_feed_id') }}">
            </div>
            <div class="col-4 mb-1">
              <label for="acars_frequencies">
                ACARS frequencies <span class="text-danger" id="acars_frequencies_error"
                style="display: none;"><br>values must fit in 2MHz</span>
              </label>
            </div>
            <div class="col-8 mb-1" data-update="acarsdec--update">
              <input type="text" class="mx-auto w-100 two_mhz" name="acars_frequencies" id="acars_frequencies"
                     placeholder="130.025 130.450 131.125 131.450 131.475 131.525 131.550 131.725"
                     value="{{ env_value_by_tag('acars_frequencies') }}">
            </div>
            {% if env_value_by_tag('acarsserial') == '' %}
            <div class="col-12 mb-1 text-warning">
              <p>No SDR is assigned for ACARS - you can change that on the <a href="/sdr_setup">SDR Setup</a> page.</p>
            </div>
            {% endif %}
            {% endif %}
          </div>
          <div class="row border">
            {% if not is_enabled('acarsdec2') %}
            <!-- second ACARS -->
            <div class="col-8 my-1">
              <label for="acarsdec2--enable">
                Enable second analog ACARS decoder (to allow covering the rarely used frequencies below 130MHz - which is rarely useful outside of the US)
              </label>
            </div>
            <div class="col-4 my-1">
              <button type="submit" class="btn btn-primary mx-auto w-100" name="acarsdec2--enable"
                      value="go">Enable</button>
            </div>
            {% else %}
            <div class="col-6 my-1">
              <label for="acarsdec2--disable">
                Second analog ACARS decoder
              </label>
            </div>
            <div class="col-3 my-1">
              <button type="submit" class="btn btn-secondary mx-auto w-100" name="acarsdec2--disable"
                      value="go">Disable</button>
            </div>
            <div class="col-3 my-1">
              <button type="submit" class="btn btn-primary mx-auto w-100" name="acarsdec2--update"
                      value="go">Update</button>
            </div>
            <div class="col-4 mb-1">
              <label for="acars_2_feed_id">
                ACARS2 feed ID
              </label>
            </div>
            <div class="col-8 mb-1">
              <input type="text" class="mx-auto w-100" name="acars_2_feed_id" id="acars_2_feed_id"
                     value="{{ env_value_by_tag('acars_2_feed_id') }}">
            </div>
            <div class="col-4 mb-1">
              <label for="acars_2_frequencies">
                ACARS2 frequencies <span class="text-danger" id="acars_2_frequencies_error"
                style="display: none;"><br>values must fit in 2MHz</span>
              </label>
            </div>
            <div class="col-8 mb-1" data-update="acarsdec2--update">
              <input type="text" class="mx-auto w-100 two_mhz" name="acars_2_frequencies" id="acars_2_frequencies"
                     placeholder="128.975 129.000 129.125 129.350 129.525 130.425 130.825 130.850"
                     value="{{ env_value_by_tag('acars_2_frequencies') }}">
            </div>
            {% if env_value_by_tag('acars_2serial') == '' %}
            <div class="col-12 mb-1 text-warning">
              <p>No SDR is assigned for ACARS_2 - you can change that on the <a href="/sdr_setup">SDR Setup</a> page.</p>
            </div>
            {% endif %}
            {% endif %}
          </div>
          <div class="row border">
            {% if not is_enabled('dumpvdl2') %}
            <!-- VDL Mode 2 -->
            <div class="col-8 my-1">
              <label for="dumpvdl2--enable">
                Enable VDL Mode 2 decoder
              </label>
            </div>
            <div class="col-4 my-1">
              <button type="submit" class="btn btn-primary mx-auto w-100" name="dumpvdl2--enable"
                      value="go">Enable</button>
            </div>
            {% else %}
            <div class="col-6 my-1">
              <label for="dumpvdl2--disable">
                VDL Mode 2 decoder
              </label>
            </div>
            <div class="col-3 my-1">
              <button type="submit" class="btn btn-secondary mx-auto w-100" name="dumpvdl2--disable"
                      value="go">Disable</button>
            </div>
            <div class="col-3 my-1">
              <button type="submit" class="btn btn-primary mx-auto w-100" name="dumpvdl2--update"
                      value="go">Update</button>
            </div>
            <div class="col-4 mb-1">
              <label for="vdl2_feed_id">
                VDL2 feed ID
              </label>
            </div>
            <div class="col-8 mb-1">
              <input type="text" class="mx-auto w-100" name="vdl2_feed_id" id="vdl2_feed_id"
                     value="{{ env_value_by_tag('vdl2_feed_id') }}">
            </div>
            <div class="col-4 mb-1">
              <label for="vdl2_frequencies">
                VDL2 frequencies<span class="text-danger" id="vdl2_frequencies_error"
                style="display: none;"><br>values must fit in 2MHz</span>
              </label>
            </div>
            <div class="col-8 mb-1" data-update="dumpvdl2--update">
              <input type="text" class="mx-auto w-100 two_mhz" name="vdl2_frequencies" id="vdl2_frequencies"
                     placeholder="136975000 136945000 136925000 136825000 136800000 136775000"
                     value="{{ env_value_by_tag('vdl2_frequencies') }}">
            </div>
            {% if env_value_by_tag('vdl2serial') == '' %}
            <div class="col-12 mb-1 text-warning">
              <p>No SDR is assigned for VDL2 - you can change that on the <a href="/sdr_setup">SDR Setup</a> page.</p>
            </div>
            {% endif %}
            {% endif %}
          </div>
          <div class="row border">
            {% if not is_enabled('dumphfdl') %}
            <!-- HFDL -->
            <div class="col-8 my-1">
              <label for="dumphfdl--enable">
                Enable HFDL support
              </label>
            </div>
            <div class="col-4 my-1">
              <button type="submit" class="btn btn-primary mx-auto w-100" name="dumphfdl--enable" value="go">Enable</button>
            </div>
            {% else %}
            <div class="col-6 my-1">
              <label for="dumphfdl--disable">
                HFDL support
              </label>
            </div>
            <div class="col-3 my-1">
              <button type="submit" class="btn btn-secondary mx-auto w-100" name="dumphfdl--disable" value="go">Disable</button>
            </div>
            <div class="col-3 my-1">
              <button type="submit" class="btn btn-primary mx-auto w-100" name="dumpvhfdl--update" value="go">Update</button>
            </div>
            <div class="col-4 mb-1">
              <label for="hfdl_feed_id">
                HFDL feed ID
              </label>
            </div>
            <div class="col-8 mb-1">
              <input type="text" class="mx-auto w-100" name="hfdl_feed_id" id="hfdl_feed_id"
                     value="{{ env_value_by_tag('hfdl_feed_id') }}">
            </div>
            <div class="col-4 mb-1">
              <label for="hfdlgaintype">
                HFDL gain type
              </label>
            </div>
            <div class="col-8 mb-1">
              <input type="text" class="mx-auto w-100" name="hfdlgaintype" id="hfdlgaintype" value="{{ env_value_by_tag('hfdlgaintype') }}">
            </div>
            <div class="col-4 mb-1">
              <label for="hfdlgain">
                HFDL gain
              </label>
            </div>
            <div class="col-8 mb-1">
              <input type="text" class="mx-auto w-100" name="hfdlgain" id="hfdlgain"
                     value="{{ env_value_by_tag('hfdlgain') }}">
            </div>
            <div class="col-4 mb-1">
              <label for="hfdl_samplerate">
                SDR sample rate
              </label>
            </div>
            <div class="col-8 mb-1">
              <input type="text" class="mx-auto w-100" name="hfdl_samplerate" id="hfdl_samplerate"
                     placeholder="3000000 for Airspy"
                     value="{{ env_value_by_tag('hfdl_samplerate') }}">
            </div>
            <div class="col-4 mb-1">
              <label for="hfdl_frequencies">
                HFDL frequencies
              </label>
            </div>
            <div class="col-8 mb-1">
              <input type="text" class="mx-auto w-100" name="hfdl_frequencies" id="hfdl_frequencies"
                     placeholder="recomended to leave empty to use frequency scanner"
                     value="{{ env_value_by_tag('hfdl_frequencies') }}">
            </div>
            {% if env_value_by_tag('hfdlserial') == '' %}
            <div class="col-12 mb-1 text-warning">
              <p>No SDR is assigned for HFDL - you can change that on the <a href="/sdr_setup">SDR Setup</a> page.</p>
            </div>
            {% endif %}
            {% endif %}
          </div>
          <div class="row border">
            {% if not is_enabled('shipfeeder') %}
            <!-- AIS -->
            <div class="col-8 my-1">
              <label for="shipfeeder--enable">
                Enable AIS / Shipfeeder
              </label>
            </div>
            <div class="col-4 my-1">
              <button type="submit" class="btn btn-primary mx-auto w-100" name="shipfeeder--enable"
                      value="go">Enable</button>
            </div>
            {% else %}
            <div class="col-6 my-1">
              <label for="shipfeeder--disable">
                AIS / Shipfeeder
              </label>
            </div>
            <div class="col-3 my-1">
              <button type="submit" class="btn btn-secondary mx-auto w-100" name="shipfeeder--disable"
                      value="go">Disable</button>
            </div>
            <div class="col-3 my-1">
              <button type="submit" class="btn btn-primary mx-auto w-100" name="shipfeeder--update"
                      value="go">Update</button>
            </div>
            <div class="col-4 mb-1">
              <label for="ais_station_name">
                AIS station name
              </label>
            </div>
            <div class="col-8 mb-1">
              <input type="text" class="mx-auto w-100" name="ais_station_name" id="ais_station_name"
                     value="{{ env_value_by_tag('ais_station_name') }}">
            </div>
            <div class="col-4 mb-1">
              <label for="ais_sx_extra_options">
                AIS extra options
              </label>
            </div>
            <div class="col-8 mb-1">
              <input type="text" class="mx-auto w-100" name="ais_sx_extra_options" id="ais_sx_extra_options"
                     value="{{ env_value_by_tag('ais_sx_extra_options') }}">
            </div>
            {% if env_value_by_tag('aisserial') == '' %}
            <div class="col-12 mb-1 text-warning">
              <p>No SDR is assigned for AIS - you can change that on the <a href="/sdr_setup">SDR Setup</a> page.</p>
            </div>
            {% endif %}
            {% endif %}
          </div>
          <div class="row border">
            {% if not is_enabled('sonde') %}
            <div class="col-8 my-1">
              <label for="sonde--enable">
                Enable Radio Sonde
              </label>
            </div>
            <div class="col-4 my-1">
              <button type="submit" class="btn btn-primary mx-auto w-100" name="sonde--enable"
                      value="go">Enable</button>
            </div>
            {% else %}
            <div class="col-6 my-1">
              <label for="sonde--disable">
                Radio Sonde
              </label>
            </div>
            <div class="col-3 my-1">
              <button type="submit" class="btn btn-secondary mx-auto w-100" name="sonde--disable"
                      value="go">Disable</button>
            </div>
            <div class="col-3 my-1">
              <button type="submit" class="btn btn-primary mx-auto w-100" name="sonde--update"
                      value="go">Update</button>
            </div>
            <div class="col-4 mb-1">
              <label for="sonde_callsign">
                Sondehub callsign
              </label>
            </div>
            <div class="col-8 mb-1">
              <input type="text" class="mx-auto w-100" name="sonde_callsign" id="sonde_callsign"
                     value="{{ env_value_by_tag('sonde_callsign') }}">
            </div>
            <div class="col-4 mb-1">
              <label for="sonde_min_freq">
                Sonde minimum frequency (this is region specific)
              </label>
            </div>
            <div class="col-8 mb-1">
              <input type="text" class="mx-auto w-100" name="sonde_min_freq" id="sonde_min_freq"
                     value="{{ env_value_by_tag('sonde_min_freq') }}">
            </div>
            <div class="col-4 mb-1">
              <label for="sonde_max_freq">
                Sonde maximum frequency (this is region specific)
              </label>
            </div>
            <div class="col-8 mb-1">
              <input type="text" class="mx-auto w-100" name="sonde_max_freq" id="sonde_max_freq"
                     value="{{ env_value_by_tag('sonde_max_freq') }}">
            </div>
            <div class="col-4 mb-1">
              <label for="sonde_share_position">
                Sondehub share station location
              </label>
            </div>
            <div class="col-8 mb-1">
              <input type="text" class="mx-auto w-100" name="sonde_share_position" id="sonde_share_position"
                     value="{{ env_value_by_tag('sonde_share_position') }}">
            </div>
            {% if env_value_by_tag('sondeserial') == '' %}
            <div class="col-12 mb-1 text-warning">
              <p>No SDR is assigned for Sonde - you can change that on the <a href="/sdr_setup">SDR Setup</a> page.</p>
            </div>
            {% endif %}
            {% endif %}
          </div>
        </div>
      </div>
    </form>
  </div>
  {% if is_enabled('acarsdec') or is_enabled('acarsdec2') or is_enabled('dumpvdl2') or is_enabled('shipfeeder') %}
  <!-- set up acars_router -->
  <div class="col-12 col-lg-6">
    <h5 class="mt-3">Data sharing of non-ADS-B data</h5>
    <form method="POST" onsubmit="show_spinner(); return true;">
      {% if is_enabled('acarsdec') or is_enabled('acarsdec2') or is_enabled('dumpvdl2') %}
      <h6 class="mt-3">ACARS / VDL Mode 2 / HFDL</h6>
      <div class="row align-items-center">
        <div class="col-1">
          <input type="checkbox" name="feed_acars_airframes" id="feed_acars_airframes" {% if is_enabled("feed_acars_airframes") %} checked {% endif %}>
        </div>
        <div class="col-11 mb-2">
          <a href="https://airframes.io/">Airframes.io</a> is an unbiased and unfiltered transportation aggregation service
          for data sources such as ACARS, VDL, HFDL, and SATCOM.
          Most people interested in tracking this kind of data want to feed this aggregator.
        </div>
        <div class="col-1">
          <input type="checkbox" name="feed_acars_avdelphi" id="feed_acars_avdelphi" {% if is_enabled("feed_acars_avdelphi") %}
                 checked {% endif %}>
        </div>
        <div class="col-11 mb-2">
          <a href="https://avdelphi.com/">AVDelphi</a> is another aggregator for ACARS data. Note that you need to claim your
          feed on their <a href="https://www.avdelphi.com/claim_feed.html">website</a> before you are allowed to feed them.
        </div>
        <div class="col-1">
          <input type="checkbox" name="feed_acars_acarsdrama" id="feed_acars_acarsframa" {% if is_enabled("feed_acars_acarsdrama") %}
                 checked {% endif %}>
        </div>
        <div class="col-11 mb-2">
          <a href="https://acarsdrama.com/">AcarsDrama</a> is a rather different type of aggregator. They are mainly focused
          on picking out things that are funny (or drama) from the large amount of ACARS data that's available.
        </div>
        <div class="col-12 mb-2">
          <button type="submit" class="btn btn-primary mx-auto w-100" name="acars_router--update"
                  value="go">Update</button>
        </div>
      </div>
      {% endif %}
      {% if is_enabled('shipfeeder') %}
      <h6 class="mt-3">AIS</h6>
      <!--     =================    -->
      <div class="row align-items-center">
      <!--     AIRFRAMES    -->
        <div class="col-1">
          <input type="checkbox" name="ais_feed_airframes" id="ais_feed_airframes"
                 {% if is_enabled("ais_feed_airframes") %} checked {% endif %}>
        </div>
        <div class="col-11 mb-2">
          <a href="https://airframes.io/">Airframes.io</a> is an unbiased and unfiltered transportation aggregation service
          that also supports AIS.
          Most people interested in tracking this kind of data want to feed this aggregator.
        </div>
      </div>
      <div class="row align-items-center">
      <!--     ADSBNETWORK    -->
        <div class="col-1">
          <input type="checkbox" name="ais_feed_adsbnetwork" id="ais_feed_adsbnetwork" {% if is_enabled("ais_feed_adsbnetwork") %}
                 checked {% endif %}>
        </div>
        <div class="col-11 mb-2">
          <a href="http://adsbnetwork.com/">RadarVirtuel / ADS-B Network</a> is a French aggregator that also collects AIS data.
          Email <a href="mailto:adsbnetwork@adsbnetwork">support@adsbnetwork.com</a> with your request to join.
        </div>
        <div class="col-2 mb-2 ais_feed_adsbnetwork_dependent"
             {% if not is_enabled("ais_feed_adsbnetwork") %}style="display: none;" {% endif %}></div>
        <div class="col-10 mb-2 ais_feed_adsbnetwork_dependent"
             {% if not is_enabled("ais_feed_adsbnetwork") %}style="display: none;" {% endif %}>
          <input type="text" class="form-control" name="ais_radarvirtuel_feeder_key" id="ais_radarvirtuel_feeder_key"
                 placeholder="Feeder Key" value="{{ env_value_by_tag('ais_radarvirtuel_feeder_key') }}">
        </div>
      </div>
      <div class="row align-items-center">
      <!--     AISCATCHER    -->
        <div class="col-1">
          <input type="checkbox" name="ais_feed_aiscatcher" id="ais_feed_aiscatcher"
                 {% if is_enabled("ais_feed_aiscatcher") %} checked {% endif %}>
        </div>
        <div class="col-11 mb-2">
          <a href="https://aiscatcher.org/">AIS Catcher</a> is a community of AIS enthusiasts dedicated to maritime tracking. Get a Sharing Key by <a href="https://aiscatcher.org/addstation">registering your station</a>.
        </div>
        <div class="col-2 mb-2 ais_feed_aiscatcher_dependent" {% if not is_enabled("ais_feed_aiscatcher") %}style="display: none;"{% endif %}></div>
        <div class="col-10 mb-2 ais_feed_aiscatcher_dependent" {% if not is_enabled("ais_feed_aiscatcher") %}style="display: none;"{% endif %}>
          <input type="text" class="form-control" name="aiscatcher_feeder_key" id="aiscatcher_feeder_key"
                 placeholder="Sharing Key"
                 value="{{ env_value_by_tag('aiscatcher_feeder_key') }}">
        </div>
      </div>
      <div class="row align-items-center">
      <!--     AISFRIENDS    -->
        <div class="col-1">
          <input type="checkbox" name="ais_feed_aisfriends" id="ais_feed_aisfriends" {% if is_enabled("ais_feed_aisfriends") %}
                 checked {% endif %}>
        </div>
        <div class="col-11 mb-2">
          <a href="https://aisfriends.com/">AIS Friends</a> is another aggregator for AIS data. Get a dedicated UDP port assigned
          by <a href="https://www.aisfriends.com/register">registering your station</a> and enter the UDP port you receive here.
        </div>
        <div class="col-2 mb-2 ais_feed_aisfriends_dependent" {% if not is_enabled("ais_feed_aisfriends") %}style="display: none;"{% endif %}></div>
        <div class="col-10 mb-2 ais_feed_aisfriends_dependent" {% if not is_enabled("ais_feed_aisfriends") %}style="display: none;"{% endif %}>
          <input type="text" class="form-control" name="aisfriends_udp_port" id="aisfriends_udp_port"
                 placeholder="AIS Friends UDP Port"
                 value="{{ env_value_by_tag('aisfriends_udp_port') }}">
        </div>
      </div>
      <div class="row align-items-center">
        <!--     AISHUB    -->
        <div class="col-1">
          <input type="checkbox" name="ais_feed_aishub" id="ais_feed_aishub"
                 {% if is_enabled("ais_feed_aishub") %} checked {% endif %}>
        </div>
        <div class="col-11 mb-2">
          <a href="https://www.aishub.net/">AISHub</a> is another aggregator for AIS data. Get a dedicated UDP port assigned
          by <a href="https://www.aishub.net/join-us">registering your station</a> and enter the UDP port you receive here.
        </div>
        <div class="col-2 mb-2 ais_feed_aishub_dependent"
             {% if not is_enabled("ais_feed_aishub") %}style="display: none;" {% endif %}></div>
        <div class="col-10 mb-2 ais_feed_aishub_dependent"
             {% if not is_enabled("ais_feed_aishub") %}style="display: none;" {% endif %}>
          <input type="text" class="form-control" name="aishub_udp_port" id="aishub_udp_port" placeholder="AISHub UDP Port"
                 value="{{ env_value_by_tag('aishub_udp_port') }}">
        </div>
      </div>
      <div class="row align-items-center">
        <!--     Boatbeacon    -->
        <div class="col-1">
          <input type="checkbox" name="ais_feed_aisboatbeacon" id="ais_feed_aisboatbeacon" {% if is_enabled("ais_feed_aisboatbeacon") %}
                 checked {% endif %}>
        </div>
        <div class="col-11 mb-2">
          <a href="https://pocketmariner.com/ais-ship-tracking/">pocketmariner / BoatBeacon</a> is another aggregator for AIS data.
        </div>
      </div>
      <div class="row align-items-center">
        <!--     HPRadar    -->
        <div class="col-1">
          <input type="checkbox" name="ais_feed_ais_hpradar" id="ais_feed_ais_hpradar"
                 {% if is_enabled("ais_feed_ais_hpradar") %} checked {% endif %}>
        </div>
        <div class="col-11 mb-2">
          <a href="https://sea.hpradar.com/">HPRadar</a> is another aggregator for AIS (and ADS-B)
          data.
        </div>
      </div>
      <div class="row align-items-center">
        <!--     sdrmap    -->
        <div class="col-1">
          <input type="checkbox" name="ais_feed_sdrmap" id="ais_feed_sdrmap" {% if is_enabled("ais_feed_sdrmap") %} checked
                 {% endif %}>
        </div>
        <div class="col-11 mb-2">
          <a href="https://sdrmap.org/">sdrmap</a> is another aggregator for AIS (and ADS-B) data.
          You need an sdrmap username and password. If you already have these, please enter them below. Otherwise, please send
          them an email at send us an email feed@sdrmap.org and request an account. To make things easier, include your broad
          location (city/state/country) in the email. In case you are feeding both ADS-B and AIS, you will use the same credentials.
        </div>
        <div class="col-2 mb-2 ais_feed_sdrmap_dependent" {% if not is_enabled("ais_feed_sdrmap") %}style="display: none;"
             {% endif %}></div>
        <div class="col-5 mb-2 ais_feed_sdrmap_dependent" {% if not is_enabled("ais_feed_sdrmap") %}style="display: none;"
             {% endif %}>
          <input type="text" class="form-control" name="sdrmap--user" id="sdrmap--user" placeholder="sdrmap user"
                 value="{{ env_value_by_tags(['sdrmap','user']) }}">
        </div>
        <div class="col-5 mb-2 ais_feed_sdrmap_dependent" {% if not is_enabled("ais_feed_sdrmap") %}style="display: none;"
             {% endif %}>
          <input type="text" class="form-control" name="sdrmap--key" id="sdrmap--key" placeholder="sdrmap key"
                 value="{{ env_value_by_tags(['sdrmap','key']) }}">
        </div>
      </div>
      <div class="row align-items-center">
        <!--     shipfinder    -->
        <div class="col-1">
          <input type="checkbox" name="ais_feed_shipfinder" id="ais_feed_shipfinder"
                 {% if is_enabled("ais_feed_shipfinder") %} checked {% endif %}>
        </div>
        <div class="col-11 mb-2">
          <a href="https://shipfinder.co/about">shipfinder</a> is another aggregator for AIS
          data.
        </div>
      </div>
      <div class="row align-items-center">
        <!--     ShippingExplorer    -->
        <div class="col-1">
          <input type="checkbox" name="ais_feed_shippingexplorer" id="ais_feed_shippingexplorer"
                 {% if is_enabled("ais_feed_shippingexplorer") %} checked {% endif %}>
        </div>
        <div class="col-11 mb-2">
          <a href="https://www.shippingexplorer.net/">ShippingExplorer</a> is another aggregator for AIS data. Get a dedicated UDP port
          assigned
          by <a href="https://www.shippingexplorer.net/en/contact">registering your station</a> and enter the UDP port you receive
          here.
        </div>
        <div class="col-2 mb-2 ais_feed_shippingexplorer_dependent"
             {% if not is_enabled("ais_feed_shippingexplorer") %}style="display: none;" {% endif %}></div>
        <div class="col-10 mb-2 ais_feed_shippingexplorer_dependent"
             {% if not is_enabled("ais_feed_shippingexplorer") %}style="display: none;" {% endif %}>
          <input type="text" class="form-control" name="ais_shippingexplorer_udp_port" id="ais_shippingexplorer_udp_port"
                 placeholder="ShippingExplorer UDP Port" value="{{ env_value_by_tag('ais_shippingexplorer_udp_port') }}">
        </div>
      </div>
      <div class="row align-items-center">
        <!--     VesselFinder    -->
        <div class="col-1">
          <input type="checkbox" name="ais_feed_vesselfinder" id="ais_feed_vesselfinder"
                 {% if is_enabled("ais_feed_vesselfinder") %} checked {% endif %}>
        </div>
        <div class="col-11 mb-2">
          <a href="https://stations.vesselfinder.com/">VesserFinder</a> is another aggregator for AIS data. Get a dedicated
          UDP port
          assigned
          by <a href="https://stations.vesselfinder.com/become-partner">registering your station</a> and enter the UDP port you receive
          here.
        </div>
        <div class="col-2 mb-2 ais_feed_vesselfinder_dependent"
             {% if not is_enabled("ais_feed_vesselfinder") %}style="display: none;" {% endif %}></div>
        <div class="col-10 mb-2 ais_feed_vesselfinder_dependent"
             {% if not is_enabled("ais_feed_vesselfinder") %}style="display: none;" {% endif %}>
          <input type="text" class="form-control" name="ais_vesselfinder_udp_port" id="ais_vesselfinder_udp_port"
                 placeholder="ShippingExplorer UDP Port" value="{{ env_value_by_tag('ais_vesselfinder_udp_port') }}">
        </div>
      </div>

      <div class="col-4">
        <button type="submit" class="btn btn-primary mx-auto w-100" name="aiscatcher--update" value="go">Update</button>
      </div>
    {% endif %}
    </form>
  </div>
  {% endif %}
</div>
<script>
  // for each input checkbox, add an onclick handler to toggle the dependent devs (which include the input field)
  $(document).ready(function () {
    $('input[type="checkbox"]').on('change', function () {
      let dependent = "." + $(this).attr('id') + "_dependent";
      let checked = $(this).is(':checked');
      $(dependent).each(function() {
        $(this).toggle(checked);
      })
    });
    function validate_two_mhz() {
      let value = $(this).val();
      value = value.replaceAll(";", " ").replaceAll(",", " ").replaceAll("  ", " ");
      let freq_array = value.split(" ").sort();
      // compare the first and last element of the sorted array and scale correctly for Hz/kHz/MHz
      let delta = freq_array[freq_array.length - 1] - freq_array[0];
      if (freq_array[0] < 200) {
        range = 2;
      } else if (freq_array[0] < 200000) {
        range = 2000;
      } else {
        range = 2000000;
      }
      // toggle the error message and set the button disabled (or not)
      $("#" + $(this).attr('id') + "_error").toggle(delta > range);
      $('button[name=' + $(this).parent().data('update') + ']').prop("disabled", delta > range);
    }
    $('input[type="text"]').each(function () {
      if ($(this).attr('class').includes("two_mhz")) {
        validate_two_mhz.call(this);
        $(this).on('change', validate_two_mhz);
      }
    });

  });
</script>
{% endblock %}
